<div class="page">
  <header class="header">
    <div class="brand">
      <span class="brand__mark" aria-hidden="true"></span>
      <div class="brand__text">
        <h1 class="brand__title">Gestione Catalogo smartphone</h1>
        <!-- <p class="brand__subtitle">Prodotti (CRUD)</p> -->
      </div>
    </div>
  </header>

  <section class="panel">
    <h2 class="panel__title">Aggiungi nuovo prodotto</h2>

    <div class="form">
      <label class="field">
        <span class="field__label">Nome</span>
        <input class="field__control" type="text" [(ngModel)]="nuovoNome" placeholder="Es. iPhone 15">
      </label>

      <label class="field field--price">
        <span class="field__label">Prezzo</span>
        <input class="field__control" type="number" [(ngModel)]="nuovoPrezzo" placeholder="0" min="0">
      </label>

      <button class="btn btn--primary" type="button" (click)="aggiungiProdotto()">
        Aggiungi
      </button>
    </div>
  </section>

  <section class="catalog">
    <div class="catalog__head">
      <h2 class="catalog__title">Prodotti</h2>
      <div class="catalog__meta">{{ prodotti.length }} totali</div>
    </div>

    @if (prodotti.length === 0) {
      <div class="empty">
        <p class="empty__title">Nessun prodotto trovato.</p>
        <p class="empty__hint">Avvia JSON Server e prova ad aggiungere un prodotto.</p>
      </div>
    } @else {
      <div class="grid">
        @for (prodotto of prodotti; track prodotto.id) {
          <article class="card">
            @if (editingId === prodotto.id) {
              <div class="card__head">
                <h3 class="card__title">Modifica</h3>
                <span class="pill pill--editing">ID {{ prodotto.id }}</span>
              </div>

              <div class="card__body">
                <label class="field">
                  <span class="field__label">Nome</span>
                  <input class="field__control" type="text" [(ngModel)]="editNome" placeholder="Nome modello">
                </label>

                <label class="field field--price">
                  <span class="field__label">Prezzo</span>
                  <input class="field__control" type="number" [(ngModel)]="editPrezzo" placeholder="0" min="0">
                </label>

                <label class="check">
                  <input class="check__box" type="checkbox" [(ngModel)]="editDisponibile">
                  <span class="check__label">Disponibile</span>
                </label>
              </div>

              <div class="card__actions card__actions--edit">
                <button class="btn btn--primary" type="button" (click)="salvaModifica()">Salva</button>
                <button class="btn btn--ghost" type="button" (click)="annullaModifica()">Annulla</button>
              </div>
            } @else {
              <div class="card__head">
                <h3 class="card__title">{{ prodotto.nome }}</h3>
                <span class="pill" [class.pill--ok]="prodotto.disponibile" [class.pill--out]="!prodotto.disponibile">
                  {{ prodotto.disponibile ? 'Disponibile' : 'Esaurito' }}
                </span>
              </div>

              <div class="card__body">
                <div class="price">
                  <span class="price__label">Prezzo</span>
                  <span class="price__value">{{ prodotto.prezzo | currency:'EUR' }}</span>
                </div>
              </div>

              <div class="card__actions">
                <button class="btn btn--info" type="button" (click)="toggleDisponibile(prodotto)">D/E</button>
                <button class="btn btn--warn" type="button" (click)="iniziaModifica(prodotto)">Modifica</button>
                <button class="btn btn--danger" type="button" (click)="eliminaProdotto(prodotto.id)">Elimina</button>
              </div>
            }
          </article>
        }
      </div>
    }
  </section>
</div>

